# 02 - Docker Volumes

## Concept
Docker volumes are used to persist data generated by containers. Unlike container filesystems (which are ephemeral), volumes survive container restarts and removals.

## What This Demo Shows
- Creating and using named volumes
- Persisting data across container restarts
- Inspecting volume data
- Sharing data between containers

## CLI Commands

### 1. Build the image
```bash
docker build -t volumes-demo .
```

### 2. Create a named volume
```bash
docker volume create app-data
```

### 3. List all volumes
```bash
docker volume ls
```

### 4. Run container with volume mounted
```bash
docker run -d -p 8000:8000 --name volumes-app -v app-data:/data volumes-demo
```

### 5. Test the app - Record visits
```bash
# Record a visit
curl -X POST http://localhost:8000/visit \
  -H "Content-Type: application/json" \
  -d '{"timestamp": "2025-11-17 10:00:00", "message": "First visit"}'

# Record another visit
curl -X POST http://localhost:8000/visit \
  -H "Content-Type: application/json" \
  -d '{"timestamp": "2025-11-17 10:05:00", "message": "Second visit"}'

# Get all visits
curl http://localhost:8000/visits
```

### 6. Stop and remove the container
```bash
docker stop volumes-app
docker rm volumes-app
```

### 7. Run a new container with the same volume
```bash
docker run -d -p 8000:8000 --name volumes-app-2 -v app-data:/data volumes-demo
```

### 8. Verify data persisted
```bash
curl http://localhost:8000/visits
# You should see the same visits from before!
```

### 9. Inspect volume details
```bash
docker volume inspect app-data
```

### 10. Access volume data directly (for debugging)
```bash
# Run a temporary container to inspect volume contents
docker run --rm -v app-data:/data alpine ls -la /data
docker run --rm -v app-data:/data alpine cat /data/visits.txt
```

### 11. Cleanup
```bash
docker stop volumes-app-2
docker rm volumes-app-2
docker volume rm app-data
```

## Key Takeaways
- Volumes persist data independently of container lifecycle
- Named volumes can be shared between containers
- Volume data survives container restarts and removals
- Use `-v volume-name:/path/in/container` to mount volumes
